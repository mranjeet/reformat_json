<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>JSON to Dart Model Generator with Copy Button and Custom Root Class Name</title>
    <link href="https://cdn.jsdelivr.net/npm/jsoneditor@9.10.0/dist/jsoneditor.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 90vh;
            overflow: hidden;
        }

        #input-pane,
        #output-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            height: 100%;
        }

        textarea {
            flex: none;
            width: 100%;
            height: 120px;
            font-family: monospace;
            font-size: 14px;
            padding: 8px;
            box-sizing: border-box;
        }

        button {
            margin: 10px 10px 10px 0;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        #autoRepairBtn {
            background-color: #ffcc00;
            color: black;
            font-weight: bold;
            border: none;
            display: none;
        }

        #autoRepairBtn:hover {
            background-color: #ffb700;
        }

        #jsoneditor {
            flex: 1;
            border: 1px solid #ddd;
            min-height: 0;
            margin-bottom: 10px;
        }

        #message {
            height: 24px;
            color: red;
            font-weight: bold;
        }

        #dartCopyButton {
            align-self: flex-start;
            margin-top: 10px;
            background-color: #3883fa;
            border: none;
            color: white;
            border-radius: 4px;
            user-select: none;
        }

        #dartCopyButton:hover {
            background-color: #2863c9;
        }

        #dartModelArea {
            margin-top: 6px;
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 10px;
            font-family: 'Fira Mono', monospace;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 40vh;
            cursor: text;
            user-select: text;
        }

        .copy-icon {
            width: 16px;
            height: 16px;
            fill: white;
        }

        #modelControlPanel {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        #classNameInput {
            width: 180px;
            padding: 6px 8px;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <div id="input-pane" style="flex: 0.5; display: flex; flex-direction: column;">
        <h3>Paste JSON Here</h3>
        <textarea id="jsonInput" placeholder="Paste raw JSON here"></textarea>
        <div>
            <button onclick="formatJson()">Format JSON</button>
            <button id="autoRepairBtn" onclick="autoRepairJson()">Auto Repair JSON</button>
        </div>
        <div id="message"></div>

        <h3>Dart Model Code</h3>
        <div id="modelControlPanel">
            <input id="classNameInput" type="text" placeholder="Enter root class name" value="Autogenerated" />
            <button id="generateModelBtn" onclick="generateDartModel()">Generate Dart Model</button>
            <button id="dartCopyButton" title="Copy Dart model code to clipboard" onclick="copyDartCode()">
                <svg viewBox="0 0 24 24" class="copy-icon" aria-hidden="true">
                    <path
                        d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zM19 5H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z">
                    </path>
                </svg>
                Copy Code
            </button>
        </div>
        <pre id="dartModelArea" title="Dart model code (read-only, click Copy Code button above)" readonly></pre>
    </div>

    <div id="output-pane">
        <h3>Formatted/Edited Output</h3>
        <div id="jsoneditor"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jsoneditor@9.10.0/dist/jsoneditor.min.js"></script>
    <script>
        const container = document.getElementById('jsoneditor');
        const messageElem = document.getElementById('message');
        const autoRepairBtn = document.getElementById('autoRepairBtn');
        const inputArea = document.getElementById('jsonInput');
        const dartModelArea = document.getElementById('dartModelArea');
        const dartCopyButton = document.getElementById('dartCopyButton');
        const classNameInput = document.getElementById('classNameInput');
        const generateModelBtn = document.getElementById('generateModelBtn');

        const editor = new JSONEditor(container, {
            modes: ['tree', 'code', 'text'],
            onError(err) {
                messageElem.textContent = err.toString();
            },
            onEvent(node, event) {
                if (event.type === 'dblclick' && node.type === 'value' && typeof node.value === 'boolean') {
                    node.setValue(!node.value);
                    messageElem.textContent = 'Boolean value toggled!';
                }
            }
        });

        function autoRepair(str) {
            let repaired = str;
            repaired = repaired.replace(/'/g, '"');
            repaired = repaired.replace(/,(\s*[\]}])/g, '$1');
            repaired = repaired.replace(/([{,]\s*)([a-zA-Z0-9_]+)\s*:/g, '$1"$2":');
            repaired = repaired.replace(/:\s*([^",\[\]\{\}\s][^,\}\]]*)/g, (match, p1) => {
                let val = p1.trim();
                if (val === 'true' || val === 'false' || val === 'null' || !isNaN(Number(val))) {
                    return `: ${val}`;
                }
                if (!val.length) {
                    return `: ${val}`;
                }
                const escaped = val.replace(/"/g, '\\"');
                return `: "${escaped}"`;
            });
            return repaired;
        }

        function formatJson() {
            messageElem.textContent = '';
            autoRepairBtn.style.display = 'none';
            try {
                const jsonObj = JSON.parse(inputArea.value);
                editor.set(jsonObj);
                messageElem.textContent = 'JSON formatted successfully!';
            } catch (e) {
                messageElem.textContent = 'Invalid JSON! You can try auto repair.';
                autoRepairBtn.style.display = 'inline-block';
                editor.set({});
            }
        }

        function autoRepairJson() {
            const repairedStr = autoRepair(inputArea.value);
            try {
                const jsonObj = JSON.parse(repairedStr);
                inputArea.value = repairedStr;
                editor.set(jsonObj);
                messageElem.textContent = 'Auto repair succeeded and JSON formatted!';
                autoRepairBtn.style.display = 'none';
            } catch (e) {
                messageElem.textContent = 'Auto repair failed!';
            }
        }

        function cleanClassName(name) {
            if (!name || typeof name !== 'string') return 'Model';
            
            // Remove invalid characters like -, _, spaces, etc.
            let cleaned = name.replace(/[-\s_]/g, '');
            
            // Keep only alphanumeric characters
            cleaned = cleaned.replace(/[^a-zA-Z0-9]/g, '');
            
            // Skip leading digits
            let i = 0;
            while (i < cleaned.length && cleaned[i].match(/\d/)) {
                i++;
            }
            cleaned = cleaned.slice(i);
            
            // If empty after cleaning, return default
            if (!cleaned) return 'Model';
            
            // Capitalize first letter
            return cleaned.charAt(0).toUpperCase() + cleaned.slice(1);
        }

        function dartType(value, className) {
            if (value === null) return 'dynamic';
            if (Array.isArray(value)) {
                if (value.length === 0) return 'List<dynamic>';
                return `List<${dartType(value[0], className)}>`;
            }
            switch (typeof value) {
                case 'string': return 'String';
                case 'number': return Number.isInteger(value) ? 'int' : 'double';
                case 'boolean': return 'bool';
                case 'object':
                    return className;
                default: return 'dynamic';
            }
        }

        function generateDartModel() {
            dartModelArea.textContent = '';
            messageElem.textContent = '';
            let jsonObj;
            try {
                jsonObj = editor.get();
            } catch {
                messageElem.textContent = 'Please format valid JSON first!';
                return;
            }
            if (!jsonObj || typeof jsonObj !== 'object') {
                messageElem.textContent = 'Output is not a JSON object. Cannot generate model.';
                return;
            }
            const rootClassName = cleanClassName(classNameInput.value.trim() || 'Autogenerated');
            const modelCode = generateDartModelClass(jsonObj, rootClassName);
            dartModelArea.textContent = modelCode;
        }

        function generateDartModelClass(jsonObj, rootClassName = 'Autogenerated') {
            const seenClasses = new Map();

            function indent(lines, level = 1) {
                const indentation = '  '.repeat(level);
                return lines.split('\n').map(line => (line ? indentation + line : '')).join('\n');
            }

            function getNestedClassName(parentClassName, key, isRoot) {
                if (isRoot) return parentClassName;
                return cleanClassName(key);
            }

            function generateClass(obj, className, isRoot = false) {
                if (seenClasses.has(className)) return;

                seenClasses.set(className, null);

                let fields = [];
                let constructorParams = [];
                let fromJsonLines = [];
                let toJsonLines = [];
                const keys = Object.keys(obj);

                for (const key of keys) {
    const val = obj[key];
    if (val && typeof val === 'object' && !Array.isArray(val)) {
        // Nested object
        const nestedClassName = getNestedClassName(className, key, false);
        generateClass(val, nestedClassName, false);
        fields.push(`${nestedClassName}? ${key};`);
        constructorParams.push(`this.${key},`);
        fromJsonLines.push(`${key} = json.containsKey('${key}') && json['${key}'] != null ? ${nestedClassName}.fromJson(json['${key}']) : null;`);
        toJsonLines.push(`'${key}': ${key}?.toJson(),`);
    } else if (Array.isArray(val)) {
        // Array handling
        if (val.length === 0) {
            fields.push(`List<dynamic>? ${key};`);
            constructorParams.push(`this.${key},`);
            fromJsonLines.push(`${key} = json.containsKey('${key}') ? json['${key}'] as List<dynamic>? : null;`);
            toJsonLines.push(`'${key}': ${key},`);
        } else {
            const firstVal = val[0];
            if (firstVal && typeof firstVal === 'object' && !Array.isArray(firstVal)) {
                // Array of nested objects
                const nestedClassName = getNestedClassName(className, key, false);
                generateClass(firstVal, nestedClassName, false);
                fields.push(`List<${nestedClassName}>? ${key};`);
                constructorParams.push(`this.${key},`);
                fromJsonLines.push(`${key} = json.containsKey('${key}') && json['${key}'] != null ? (json['${key}'] as List).map((e) => ${nestedClassName}.fromJson(e)).toList() : null;`);
                toJsonLines.push(`'${key}': ${key}?.map((e) => e.toJson()).toList(),`);
                
            } else if (typeof firstVal === 'string') {
                fields.push(`List<String>? ${key};`);
                constructorParams.push(`this.${key},`);
                fromJsonLines.push(`${key} = json.containsKey('${key}') ? (json['${key}'] as List?)?.cast<String>() : null;`);
                toJsonLines.push(`'${key}': ${key},`);
            } else {
                const elementType = dartType(firstVal, '');
                fields.push(`List<${elementType}>? ${key};`);
                constructorParams.push(`this.${key},`);
                fromJsonLines.push(`${key} = json.containsKey('${key}') ? json['${key}'] as List<dynamic>? : null;`);
                toJsonLines.push(`'${key}': ${key},`);
            }
        }
    } else {
        const type = dartType(val, '');
        fields.push(`${type}? ${key};`);
        constructorParams.push(`this.${key},`);
        fromJsonLines.push(`${key} = json.containsKey('${key}') ? json['${key}'] : null;`);
        toJsonLines.push(`'${key}': ${key},`);
    }
}



                const classStr =
                    `class ${className} {
${indent(fields.join('\n'))}

  ${className}({
${indent(constructorParams.join('\n'))}  });

  ${className}.fromJson(Map<String, dynamic> json) {
${indent(fromJsonLines.join('\n'), 2)}
  }

  Map<String, dynamic> toJson() {
    return {
${indent(toJsonLines.join('\n'), 3)}
    };
  }
}`;

                seenClasses.set(className, classStr);
            }

            generateClass(jsonObj, rootClassName, true);

            let result = '';
            for (const cls of seenClasses.values()) {
                result += cls + '\n\n';
            }
            return result.trim();
        }

        function copyDartCode() {
            const code = dartModelArea.textContent.trim();
            if (!code) {
                messageElem.textContent = 'No Dart model code to copy!';
                return;
            }
            if (navigator.clipboard) {
                navigator.clipboard.writeText(code);
                messageElem.textContent = 'Dart model code copied to clipboard!';
                setTimeout(() => { messageElem.textContent = ''; }, 2000);
            }
        }
    </script>
</body>

</html>
